/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','jquery.sap.strings'],function(q){"use strict";
//License granted by Douglas Crockford to SAP, Apache License 2.0
//    (http://www.apache.org/licenses/LICENSE-2.0)
var d={encodeURIComponent:encodeURIComponent,Math:Math,odata:{fillUriTemplate:function(){if(!URI.expand){q.sap.require("sap.ui.thirdparty.URITemplate");}return URI.expand.apply(URI,arguments).toString();},uriEncode:function(){var O;q.sap.require("sap.ui.model.odata.ODataUtils");O=sap.ui.model.odata.ODataUtils;return O.formatValue.apply(O,arguments);}},RegExp:RegExp},s={"BINDING":{led:u,nud:function(T,P){return q.proxy(B,null,T.value);}},"IDENTIFIER":{led:u,nud:function(T,P){return q.proxy(a,null,P.globals[T.value]);}},"CONSTANT":{led:u,nud:function(T,P){return q.proxy(a,null,T.value);}},".":{lbp:18,led:function(T,P,l){return q.proxy(D,null,l,P.advance("IDENTIFIER").value);},nud:u},"(":{lbp:17,led:function(T,P,l){var A=[],e=true;while(P.current().id!==")"){if(e){e=false;}else{P.advance(",");}A.push(P.expression(0));}P.advance(")");return q.proxy(F,null,l,A);},nud:function(T,P){var v=P.expression(0);P.advance(")");return v;}},"!":{lbp:15,led:u,nud:function(T,P){return q.proxy(U,null,P.expression(this.lbp),function(x){return!x;});}},"typeof":{lbp:15,led:u,nud:function(T,P){return q.proxy(U,null,P.expression(this.lbp),function(x){return typeof x;});}},"?":{lbp:4,led:function(T,P,l){var e,g;g=P.expression(this.lbp-1);P.advance(":");e=P.expression(this.lbp-1);return q.proxy(C,null,l,g,e);},nud:u},")":{led:u,nud:u},"{":{led:u,nud:function(T,P){var e=true,k,m={},v;while(P.current().id!=="}"){if(e){e=false;}else{P.advance(",");}if(P.current()&&P.current().id==="CONSTANT"&&typeof P.current().value==="string"){k=P.advance().value;}else{k=P.advance("IDENTIFIER").value;}P.advance(":");v=P.expression(0);m[k]=v;}P.advance("}");return q.proxy(M,null,m);}},"}":{lbp:-1,led:u,nud:u},",":{led:u,nud:u},":":{led:u,nud:u}},t=["===","!==","!","||","&&",".","(",")","{","}",":",",","?","*","/","%","+","-","<=","<",">=",">"],r;q.each(t,function(i,T){t[i]=q.sap.escapeRegExp(T);});r=new RegExp(t.join("|"),"g");b("*",14,function(x,y){return x*y;});b("/",14,function(x,y){return x/y;});b("%",14,function(x,y){return x%y;});b("+",13,function(x,y){return x+y;}).nud=function(T,P){return q.proxy(U,null,P.expression(this.lbp),function(x){return+x;});};b("-",13,function(x,y){return x-y;}).nud=function(T,P){return q.proxy(U,null,P.expression(this.lbp),function(x){return-x;});};b("<=",11,function(x,y){return x<=y;});b("<",11,function(x,y){return x<y;});b(">=",11,function(x,y){return x>=y;});b(">",11,function(x,y){return x>y;});b("===",10,function(x,y){return x===y;});b("!==",10,function(x,y){return x!==y;});b("&&",7,function(x,y){return x&&y();},true);b("||",6,function(x,y){return x||y();},true);function B(i,P){return P[i];}function C(e,T,E,P){return e(P)?T(P):E(P);}function a(v){return v;}function D(l,i,P){var o=l(P),v=o[i];return typeof v==="function"?v.bind(o):v;}function F(l,A,P){var R=[];q.each(A,function(i,e){R[i]=e(P);});return l(P).apply(null,R);}function I(l,R,o,L,P){return o(l(P),L?q.proxy(R,null,P):R(P));}function M(m,P){var R={};q.each(m,function(k,v){R[k]=v(P);});return R;}function U(R,o,P){return o(R(P));}function b(i,e,o,l){s[i]={lbp:e,led:function(T,P,L){var g=l?this.lbp-1:this.lbp;return q.proxy(I,null,L,P.expression(g),o,l);},nud:u};return s[i];}function c(m,i,A){var e=new SyntaxError(m);e.at=A;e.text=i;if(A!==undefined){m+=" at position "+A;}q.sap.log.error(m,i,"sap.ui.base.ExpressionParser");throw e;}function u(T){var e=T.input.slice(T.start,T.end);c("Unexpected "+T.id+(e!==T.id?": "+e:""),T.input,T.start+1);}function f(R,i,S){var P=[],t=[],T=q.sap._createJSTokenizer();function g(){var h,o,j,m,k;T.white();h=T.getCh();j=T.getIndex();if(/[a-z]/i.test(h)){m=/[a-z]\w*/i.exec(i.slice(j));if(m[0]==="false"||m[0]==="null"||m[0]==="true"){k={id:"CONSTANT",value:T.word()};}else if(m[0]==="typeof"){k={id:"typeof"};T.setIndex(j+m[0].length);}else{k={id:"IDENTIFIER",value:m[0]};T.setIndex(j+m[0].length);}}else if(/\d/.test(h)||h==="."&&/\d/.test(i.charAt(T.getIndex()+1))){k={id:"CONSTANT",value:T.number()};}else if(h==="'"||h==='"'){k={id:"CONSTANT",value:T.string()};}else if(h==="$"){T.next("$");T.next("{");o=R(i,T.getIndex()-1);k={id:"BINDING",value:P.length};P.push(o.result);T.setIndex(o.at);}else{r.lastIndex=j;m=r.exec(i);if(!m||m.index!==j){return false;}k={id:m[0]};T.setIndex(j+m[0].length);}k.input=i;k.start=j;k.end=T.getIndex();t.push(k);return true;}T.init(i,S);try{while(g()){}}catch(e){if(e.name==="SyntaxError"){c(e.message,e.text,e.at);}else{throw e;}}return{at:T.getIndex(),parts:P,tokens:t};}function p(t,i,g){var e,n=0,P={advance:h,current:j,expression:k,globals:g},T;function h(E){var T=t[n];if(E){if(!T){c("Expected "+E+" but instead saw end of input",i);}else if(T.id!==E){c("Expected "+E+" but instead saw "+i.slice(T.start,T.end),i,T.start+1);}}n+=1;return T;}function j(){return t[n];}function k(l){var L;T=h();if(!T){c("Expected expression but instead saw end of input",i);}L=s[T.id].nud(T,P);while(n<t.length){T=j();if(l>=(s[T.id].lbp||0)){break;}h();L=s[T.id].led(T,P,L);}return L;}e=k(-1);return{at:j()?j().start:undefined,formatter:e};}return{parse:function(R,i,S,g){var o,T;T=f(R,i,S);o=p(T.tokens,i,g||d);if(!S&&T.at<i.length){c("Invalid token in expression",i,T.at);}if(!T.parts.length){return{constant:o.formatter(),at:o.at||T.at};}function e(){return o.formatter(arguments);}e.textFragments=true;return{result:{formatter:e,parts:T.parts},at:o.at||T.at};}};},true);
